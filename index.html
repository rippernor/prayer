<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5, minimum-scale=0.5, user-scalable=yes" />
  <title>Prayer & Info Dashboard</title>
  <style>
    html, body {
      margin: 0; padding: 0;
      height: 100%; min-height: 100vh;
      background: linear-gradient(135deg, #0a2233 0%, #1a2a38 100%);
      color: #f3f7fa;
      font-family: Arial, sans-serif; /* changed from Inter to Arial for offline */
      overflow-x: hidden !important;
    }
    body {
      min-height: 100vh;
      overflow-y: auto;
      font-size: clamp(16px, 2vw, 24px);
    }
    .page {
      height: 100vh;
      width: 100%;
      max-width: 100vw;
      overflow-x: auto;
      padding: 0 1rem;
      box-sizing: border-box;
      background: transparent;
      color: #eaf6fb;
      display: none;
      flex-direction: column;
      position: relative;
    }
    .page.active {
      display: flex;
    }
    #page1 main, #page1 .glass-panel, #page1 .prayer-table, #page2 .glass-panel {
      padding-left: 0;
      padding-right: 0;
      margin-left: 0;
      margin-right: 0;
      width: 100%;
      box-sizing: border-box;
    }
    /* Added horizontal scrolling on page1 containers */
    #page1 main,
    #page1 .glass-panel,
    #page1 .prayer-table {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    #page1 header {
      height: 7.5rem;
      background: rgba(18,28,38,0.98);
      box-shadow: 0 2px 12px rgba(0,0,0,0.7);
      user-select: none;
      font-weight: 700;
      color: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 0.5rem;
      box-sizing: border-box;
      z-index: 10;
      position: relative;
    }
    #page1 header .time {
      color: #ffffff;
      font-variant-numeric: tabular-nums;
      user-select: none;
      font-weight: 700;
      font-size: clamp(6rem, 9vw, 10rem);
      white-space: nowrap;
      cursor: default;
      margin: 1.5rem 0 0 0;
      text-align: center;
      line-height: 1;
      max-width: none;
      background: transparent;
      border-radius: 0;
      padding: 0;
      box-shadow: none;
      position: static;
      z-index: auto;
      flex-grow: 0;
    }
    #page1 main {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: stretch;
      background: transparent;
      overflow: hidden;
      box-sizing: border-box;
      margin-top: 1rem;
      height: calc(100vh - 9.5rem);
    }
    #page1 .glass-panel {
      background: rgba(18, 28, 38, 0.93);
      border-radius: 14px;
      backdrop-filter: blur(4px);
      border: 2px solid #7fff00;
      box-shadow:
        0 0 0 1px #7fff0099,
        0 0 15px 2px #7fff0077,
        0 0 30px 5px #7fff0044;
      box-sizing: border-box;
      color: #ffffff;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      width: 98vw;
      max-width: 98vw;
      max-height: calc(100vh - 9.5rem);
      padding: 12px 24px;
      margin-top: 8px;
      animation: glow-shift 4s ease-in-out infinite;
    }
    #page2 .glass-panel {
      background: rgba(18, 28, 38, 0.93);
      border-radius: 14px;
      backdrop-filter: blur(4px);
      border: 2px solid #7fff00;
      box-shadow:
        0 0 0 1px #7fff0099,
        0 0 15px 2px #7fff0077,
        0 0 30px 5px #7fff0044;
      width: 98vw;
      max-width: 98vw;
      max-height: 90vh;
      padding: 3rem 24px;
      box-sizing: border-box;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-weight: 900;
      font-size: clamp(8rem, 12vw, 14rem);
      user-select: none;
      color: #7fff00;
      margin: 0;
      animation: glow-shift 4s ease-in-out infinite;
    }
    #page1 .prayer-table {
      width: 100%;
      height: 100%;
      max-width: none !important;
      font-size: clamp(3.5rem, 4vw, 6.5rem) !important;
      font-weight: 900;
      user-select: text;
      display: flex;
      flex-direction: column;
      justify-content: center;
      box-sizing: border-box;
    }
    #page1 .prayer-table table {
      border-collapse: collapse;
      border-spacing: 0;
      width: 100% !important;
      height: 100% !important;
      font-weight: 900;
      font-size: inherit !important;
      color: #ffffff;
      word-break: break-word;
      white-space: nowrap;
      margin: 0;
      border-radius: 0 0 14px 14px;
      border: none;
      box-sizing: border-box;
      padding-bottom: 0.5rem;
      display: table;
      table-layout: fixed;
    }
    #page1 .prayer-table tbody tr {
      height: calc(100% / 7);
    }
    #page1 .prayer-table thead tr {
      background-color: rgba(18, 28, 38, 0.9);
      font-size: clamp(4rem, 5vw, 6.5rem) !important;
      color: #7fff00 !important;
      text-shadow: none;
      height: auto;
    }
    #page1 .prayer-table thead th {
      color: #7fff00 !important;
      border-left: 2px solid rgba(127, 255, 0, 0.6);
      border-bottom: 2px solid rgba(127, 255, 0, 0.6);
      border-right: 2px solid rgba(127, 255, 0, 0.6);
      padding: 0.6rem 1.5rem !important;
      font-weight: 900;
      user-select: none;
      width: 50%;
    }
    #page1 .prayer-table th,
    #page1 .prayer-table td {
      width: 50%;
      padding: 0.6rem 1.5rem !important;
      border-bottom: 2px solid rgba(127, 255, 0, 0.6);
      color: #ffffff;
      text-align: center;
      white-space: normal; /* allow wrapping by default */
      user-select: none;
      font-size: inherit;
      font-weight: 900;
      font-family: Arial, Verdana, monospace; /* fallback font */
      line-height: 1.1;
      transition: color 0.3s ease;
      vertical-align: middle;
      box-sizing: border-box;
    }
    /* Fix first column to prevent breaking words (Salat, Jummah etc) */
    #page1 .prayer-table th:first-child,
    #page1 .prayer-table td:first-child {
      border-left: none;
      border-right: none;
      text-align: left;
      padding-left: 1.5rem !important;
      width: auto;
      white-space: nowrap;
      overflow: visible;
      word-break: normal;
    }
    /* Keep last column jamat time nowrap */
    #page1 .prayer-table th:last-child,
    #page1 .prayer-table td:last-child {
      border-left: 2px solid rgba(127, 255, 0, 0.6);
      border-right: none;
      text-align: center;
      white-space: nowrap;
    }
    #page1 .prayer-table tbody tr:last-child td {
      border-bottom: none !important;
      border-bottom-left-radius: 14px;
      border-bottom-right-radius: 14px;
    }
    #page1 .prayer-table tbody tr.current-prayer {
      background-color: rgba(127, 255, 0, 0.25);
      color: #7fff00;
      font-weight: 900;
      text-shadow: none;
    }
    #page1 .prayer-table tbody tr .jamat-time.blinking {
      color: #7fff00 !important;
      animation: blink 1s step-start 0s infinite;
      font-weight: 900;
    }
    #page1 .prayer-table tbody tr .blinking {
      animation: blink 1s step-start 0s infinite;
    }
    @keyframes blink {
      50% { opacity: 0; }
      100% { opacity: 1; }
    }
    @keyframes glow-shift {
      0%, 100% {
        border-color: #7fff00;
        box-shadow:
          0 0 0 1px #7fff0099,
          0 0 15px 2px #7fff0077,
          0 0 30px 5px #7fff0044;
      }
      50% {
        border-color: #ffff33;
        box-shadow:
          0 0 0 1px #ffff3399,
          0 0 15px 2px #ffff3377,
          0 0 30px 5px #ffff3344;
      }
    }
    #page2 {
      display: none;
      position: relative;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      width: 100vw;
      height: 100vh;
      background: transparent;
      box-sizing: border-box;
      padding: 2rem 1rem 1rem 1rem;
      color: #7fff00;
    }
    #page2.active {
      display: flex;
    }
    #page2 .countdown-label {
      font-size: clamp(4rem, 6vw, 7rem);
      font-weight: 700;
      margin-bottom: 0.5em;
    }
    #page2 .countdown-number {
      font-family: Arial, Verdana, monospace;
      font-weight: 900;
      font-size: clamp(12rem, 18vw, 22rem);
      line-height: 1;
      margin-bottom: 0.3em;
    }
    #page2 .countdown-number.blinking {
      animation: blink 1s step-start 0s infinite;
    }
    #page2 .current-prayer-info {
      font-size: clamp(3rem, 4vw, 5rem);
      font-weight: 700;
      max-width: 80vw;
      line-height: 1.1;
      user-select: none;
    }
    .date-panel {
      position: absolute;
      top: 1rem;
      z-index: 15;
      color: #7fff00;
      font-weight: 600;
      user-select: none;
      white-space: nowrap;
      padding: 0 0.5rem;
      box-sizing: border-box;
      font-size: clamp(3rem, 5vw, 6rem);
      max-width: 45vw;
      text-shadow: none;
      line-height: 1.1;
    }
    #page2 .date-gregorian {
      left: 1rem;
      text-align: left;
    }
    #page2 .date-hijri {
      right: 1rem;
      text-align: right;
    }
    @media screen and (max-width: 600px) {
      #page1 .prayer-table {
        font-size: clamp(2rem, 4vw, 5rem) !important;
      }
      #page1 .prayer-table thead th {
        font-size: clamp(2.5rem, 5vw, 4rem) !important;
      }
      #page2 .glass-panel {
        font-size: clamp(4rem, 10vw, 8rem);
        padding: 2rem 1rem;
        width: 100vw;
        max-width: 100vw;
      }
      #page2 .countdown-number {
        font-size: clamp(8rem, 14vw, 16rem);
      }
      #page2 .countdown-label {
        font-size: clamp(2rem, 5vw, 3rem);
      }
      #page2 .current-prayer-info {
        font-size: clamp(1.5rem, 4vw, 2.5rem);
        max-width: 90vw;
      }
      #page1 header {
        height: 5rem;
      }
      #page1 header .time {
        font-size: clamp(3rem, 7vw, 6rem);
        margin: 0.75rem 0 0 0;
      }
      /* Slightly reduce padding on small screens */
      #page1 .prayer-table td:first-child,
      #page1 .prayer-table th:first-child {
        padding-left: 1rem !important;
      }
    }
    @media screen and (max-height: 500px) and (orientation: landscape) {
      .page {
        height: 100%;
        max-height: 100%;
      }
      #page1 main {
        height: auto;
        max-height: 60vh;
        margin-top: 0.5rem;
      }
    }
    body {
      overflow-x: hidden;
    }
  </style>
</head>
<body>

  <div id="page1" class="page active" role="main" aria-label="Prayer Times Dashboard">
    <header>
      <div class="time" id="time-line" title="Current time with seconds" aria-live="polite" aria-atomic="true"></div>
    </header>
    <main>
      <section class="glass-panel" aria-label="Jamat Times Prayer Table">
        <div class="prayer-table" aria-describedby="prayer-description">
          <table>
            <thead>
              <tr>
                <th scope="col">Salat</th>
                <th scope="col">Jamat</th>
              </tr>
            </thead>
            <tbody id="prayer-row"></tbody>
          </table>
          <div id="prayer-description" hidden>
            This table displays prayer names with their corresponding Jamat times. Azan times are hidden.
          </div>
        </div>
      </section>
    </main>
  </div>

  <div id="page2" class="page" aria-label="Glowing Countdown and Dates" role="region" tabindex="0" aria-live="polite" aria-atomic="true">
    <div class="date-panel date-gregorian" id="date-gregorian-line-2" title="Current Gregorian date"></div>
    <div class="glass-panel">
      <div class="countdown-label" aria-live="assertive" aria-atomic="true"></div>
      <div class="countdown-number" aria-live="assertive" aria-atomic="true"></div>
      <div class="current-prayer-info" aria-live="polite" aria-atomic="true"></div>
    </div>
    <div class="date-panel date-hijri" id="date-hijri-line-2" title="Current Hijri date"></div>
  </div>

  <script>
    let hijriDate = "";
    let prayers = [];

    const BLINK_WINDOW_MS = 30000; // Blink time window ±30 sec
    const GREEN_HOLD_MS = 120000;  // After blink hold green text 2 minutes

    function parseTimeToDate(timeStr) {
      if (!timeStr || timeStr === "--:--") return null;
      const [hh, mm] = timeStr.split(":").map(Number);
      if (isNaN(hh) || isNaN(mm)) return null;
      const now = new Date();
      return new Date(now.getFullYear(), now.getMonth(), now.getDate(), hh, mm, 0, 0);
    }

    function updateDateTime() {
      const now = new Date();
      const gregorianDate = now.toLocaleDateString("en-GB", {
        weekday: "long",
        year: "numeric",
        month: "long",
        day: "numeric"
      }).replace(/,/g, '');
      const timeStr = now.toLocaleTimeString("en-GB", {
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit",
        hour12: false,
      });
      document.getElementById("time-line").textContent = timeStr;
      document.getElementById("date-gregorian-line-2").textContent = gregorianDate;
      document.getElementById("date-hijri-line-2").textContent = hijriDate;
    }

    async function fetchHijriDate() {
      try {
        const today = new Date();
        const day = String(today.getDate()).padStart(2,'0');
        const month = String(today.getMonth()+1).padStart(2,'0');
        const year = today.getFullYear();
        const res = await fetch(`https://api.aladhan.com/v1/gToH?date=${day}-${month}-${year}`);
        const data = await res.json();
        if(data && data.data && data.data.hijri) {
          const h = data.data.hijri;
          hijriDate = `${h.day} ${h.month.en} ${h.year}`;
        } else {
          hijriDate = '';
        }
      } catch {
        hijriDate = '';
      }
      document.getElementById("date-hijri-line-2").textContent = hijriDate;
    }

    async function fetchPrayerTimes() {
      try {
        const today = new Date();
        const year = today.getFullYear();
        const month = String(today.getMonth() + 1).padStart(2, "0");
        const day = String(today.getDate()).padStart(2, "0");
        const dayOfWeek = today.getDay(); // 5 = Friday

        const url = `https://api.bonnetid.no/prayertimes/122/${year}/${month}/${day}/?asr=2`;
        const response = await fetch(url, {
          method: "GET",
          headers: {
            "User-Agent": "Mozilla/5.0",
            Accept: "application/json, text/plain, */*",
            Origin: "https://bonnetid.no",
            Referer: "https://bonnetid.no/",
            "Api-Token": "92affaa6-0e9b-4402-8d8a-0fcd8d9e91ec",
          },
        });
        if (!response.ok) throw new Error(`HTTP error! ${response.status}`);
        const data = await response.json();

        const fajrAzan = data.fajr || "04:40";
        const zuhrAzan = data.zuhr || "15:00";
        const asrAzan = data.asr || "20:00";
        const maghribAzan = data.maghrib || "--:--";
        const ishaAzan = data.isha || "--:--";
        const jumuahAzan = data.jumuah || zuhrAzan;

        // Keep both Zuhr and Jummah every day with correct spelling and time logic
        prayers = [
          { name: "Fajr", azanTime: parseTimeToDate(fajrAzan), jamatTime: parseTimeToDate("04:40") },
          { name: "Zuhr", azanTime: parseTimeToDate(zuhrAzan), jamatTime: parseTimeToDate("15:00") },
          { name: "Asr", azanTime: parseTimeToDate(asrAzan), jamatTime: parseTimeToDate("20:00") },
          // Maghrib jamat = maghrib azan time (no +5 min)
          { name: "Maghrib", azanTime: parseTimeToDate(maghribAzan), jamatTime: parseTimeToDate(maghribAzan) },
          { name: "Isha", azanTime: parseTimeToDate(ishaAzan), jamatTime: null }, // will set below
          { name: "Jummah", azanTime: parseTimeToDate(jumuahAzan), jamatTime: parseTimeToDate("15:00") }
        ];

        const maghribDate = parseTimeToDate(maghribAzan);

        if(maghribDate) {
          prayers[3].jamatTime = maghribDate;
          // Isha jamat is 25 mins after original maghrib azan but modified as +20 minutes per your request
          prayers[4].azanTime = new Date(maghribDate.getTime() + 20 * 60000);
          prayers[4].jamatTime = new Date(maghribDate.getTime() + 45 * 60000); // maghrib + 20 + 25 = maghrib + 45 min
        } else {
          prayers[3].jamatTime = null;
          prayers[4].azanTime = null;
          prayers[4].jamatTime = null;
        }
      } catch (error) {
        prayers = [];
        console.error("Failed to fetch prayer times:", error);
      }
    }

    function updatePrayerTable() {
      const tbody = document.getElementById("prayer-row");
      tbody.innerHTML = "";
      if (!prayers.length) {
        tbody.innerHTML = "<tr><td colspan='2'>Prayer times unavailable</td></tr>";
        return;
      }
      const now = new Date();
      const dayOfWeek = now.getDay();

      let currentIndex = -1;

      for (let i = 0; i < prayers.length; i++) {
        const p = prayers[i];
        if (!p.azanTime) continue;
        const azanTime = p.azanTime.getTime();
        const jamatTime = p.jamatTime ? p.jamatTime.getTime() : Infinity;

        if (p.name === "Isha") {
          const fiveMinBeforeIsha = azanTime - 5 * 60000;
          if (now >= fiveMinBeforeIsha && now < jamatTime) {
            currentIndex = i;
            break;
          }
        } else {
          if (now >= azanTime && now < jamatTime) {
            currentIndex = i;
            break;
          }
        }
      }

      prayers.forEach((p, idx) => {
        const tr = document.createElement("tr");
        if (idx === currentIndex) tr.classList.add("current-prayer");

        const tdName = document.createElement("td");
        tdName.textContent = p.name;

        const tdJamat = document.createElement("td");
        tdJamat.textContent = p.jamatTime
          ? p.jamatTime.toLocaleTimeString("en-GB", { hour: "2-digit", minute: "2-digit", hour12: false })
          : "--:--";
        tdJamat.style.textAlign = "center";
        tdJamat.style.fontFamily = "Arial, Verdana, monospace";
        tdJamat.classList.add("jamat-time");

        const nowTime = now.getTime();

        if (idx === currentIndex) {
          tdName.style.color = "#7fff00";
          tdName.style.fontWeight = "900";

          const isFriday = dayOfWeek === 5;

          // Jummah stays green from previous day Maghrib (Fridays start at sunset of previous day)
          if (p.name === "Jummah" && isFriday) {
            const prevDay = new Date(now);
            prevDay.setDate(now.getDate() - 1);
            const maghribPrevDay = parseTimeToDate(prayers.find(pr => pr.name === "Maghrib").azanTime.toTimeString().slice(0,5), prevDay);
            if(now >= maghribPrevDay) {
              tdName.classList.add("blinking");
              tdName.style.color = "#7fff00";
              tdJamat.style.color = "#7fff00";
              tdJamat.classList.add("blinking");
            }
          } else if (p.name === "Zuhr" && !isFriday) {
            tdName.classList.remove("blinking");
            tdJamat.style.color = "#7fff00";
            tdJamat.classList.remove("blinking");
          } else if (p.name === "Isha") {
            const ishaAzan = p.azanTime.getTime();
            if (nowTime >= ishaAzan && nowTime < (p.jamatTime ? p.jamatTime.getTime() : Infinity)) {
              tdName.classList.add("blinking");
            } else {
              tdName.classList.remove("blinking");
            }

            if (p.jamatTime) {
              const diffJamat = p.jamatTime.getTime() - nowTime;
              if (diffJamat <= BLINK_WINDOW_MS && diffJamat >= -BLINK_WINDOW_MS) {
                tdJamat.style.color = "#7fff00";
                tdJamat.classList.add("blinking");
              } else if (diffJamat < -BLINK_WINDOW_MS && diffJamat >= -BLINK_WINDOW_MS - GREEN_HOLD_MS) {
                tdJamat.style.color = "#7fff00";
                tdJamat.classList.remove("blinking");
              } else {
                tdJamat.style.color = "#ffffff";
                tdJamat.classList.remove("blinking");
              }
            }
          } else {
            tdName.classList.remove("blinking");
            if (p.jamatTime) {
              const diffJamat = p.jamatTime.getTime() - nowTime;
              if (diffJamat <= BLINK_WINDOW_MS && diffJamat >= -BLINK_WINDOW_MS) {
                tdJamat.style.color = "#7fff00";
                tdJamat.classList.add("blinking");
              } else if (diffJamat < -BLINK_WINDOW_MS && diffJamat >= -BLINK_WINDOW_MS - GREEN_HOLD_MS) {
                tdJamat.style.color = "#7fff00";
                tdJamat.classList.remove("blinking");
              } else {
                tdJamat.style.color = "#ffffff";
                tdJamat.classList.remove("blinking");
              }
            }
          }
        } else {
          tdName.classList.remove("blinking");
          tdName.style.color = "#ffffff";
          tdName.style.fontWeight = "900";
          tdJamat.classList.remove("blinking");
          tdJamat.style.color = "#ffffff";
        }

        tr.appendChild(tdName);
        tr.appendChild(tdJamat);

        tbody.appendChild(tr);
      });
    }

    function startCountdown() {
      const countdownLabel = document.querySelector("#page2 .countdown-label");
      const countdownNumber = document.querySelector("#page2 .countdown-number");
      const prayerInfo = document.querySelector("#page2 .current-prayer-info");

      if (countdownInterval) clearInterval(countdownInterval);

      countdownInterval = setInterval(() => {
        const now = new Date();

        let nextPrayer = null;
        for (let p of prayers) {
          if(p.jamatTime && p.jamatTime > now) {
            nextPrayer = p;
            break;
          }
        }

        if(!nextPrayer) {
          const firstPrayer = prayers[0];
          if(firstPrayer && firstPrayer.jamatTime) {
            const tomorrowJamat = new Date(firstPrayer.jamatTime.getTime() + 24 * 60 * 60 * 1000);
            const diff = tomorrowJamat.getTime() - now.getTime();

            countdownLabel.textContent = `${firstPrayer.name} Jamat in:`;
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            countdownNumber.textContent = `${String(hours).padStart(2,"0")}:${String(minutes).padStart(2,"0")}:${String(seconds).padStart(2,"0")}`;
            countdownNumber.classList.remove("blinking");
            prayerInfo.textContent = "";
          } else {
            countdownLabel.textContent = "";
            countdownNumber.textContent = "--:--:--";
            countdownNumber.classList.remove("blinking");
            prayerInfo.textContent = "";
          }
          return;
        }

        const diff = nextPrayer.jamatTime.getTime() - now.getTime();

        if(diff <= 0) {
          countdownLabel.textContent = "Starting prayer...";
          countdownNumber.textContent = "00:00:00";
          countdownNumber.classList.remove("blinking");
          prayerInfo.textContent = "";
          return;
        }

        const hours = Math.floor(diff / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);

        countdownLabel.textContent = `${nextPrayer.name} Jamat in:`;
        countdownNumber.textContent = `${String(hours).padStart(2,"0")}:${String(minutes).padStart(2,"0")}:${String(seconds).padStart(2,"0")}`;
        prayerInfo.textContent = "";

        if(diff <= BLINK_WINDOW_MS) {
          countdownNumber.classList.add("blinking");
        } else {
          countdownNumber.classList.remove("blinking");
        }
      }, 500);
    }

    const page1 = document.getElementById('page1');
    const page2 = document.getElementById('page2');

    function showPage2Temporarily() {
      const now = new Date();
      const day = now.getDay();

      const jummahPrayer = prayers.find(p => p.name === "Jummah");
      if (day === 5 && jummahPrayer && jummahPrayer.jamatTime) {
        const jamatTime = jummahPrayer.jamatTime.getTime();
        const windowStart = jamatTime - 15 * 60 * 1000;
        const windowEnd = jamatTime + 30 * 60 * 1000;
        const nowTime = now.getTime();

        if (nowTime >= windowStart && nowTime <= windowEnd) {
          return;
        }
      }

      page1.classList.remove('active');
      page2.classList.add('active');
      setTimeout(() => {
        page2.classList.remove('active');
        page1.classList.add('active');
      }, 15000);
    }

    setInterval(showPage2Temporarily, 5 * 60 * 1000);

    function handleJamatBlinking() {
      const now = new Date();
      const rows = document.querySelectorAll("#prayer-row tr");

      prayers.forEach((p,i) => {
        if(!p.jamatTime) return;
        const diff = p.jamatTime.getTime() - now.getTime();
        const tdJamat = rows[i] ? rows[i].querySelector('.jamat-time') : null;
        if(!tdJamat) return;

        if(diff <= BLINK_WINDOW_MS && diff >= -BLINK_WINDOW_MS) {
          tdJamat.classList.add("blinking");
          tdJamat.style.color = "#7fff00";
        } else if(diff < -BLINK_WINDOW_MS && diff >= -BLINK_WINDOW_MS - GREEN_HOLD_MS) {
          tdJamat.classList.remove("blinking");
          tdJamat.style.color = "#7fff00";
        } else {
          tdJamat.classList.remove("blinking");
          tdJamat.style.color = "#ffffff";
        }
      });
    }

    let countdownInterval = null;
    async function initialize() {
      await fetchHijriDate();
      await fetchPrayerTimes();
      updateDateTime();
      updatePrayerTable();
      startCountdown();

      setInterval(async () => {
        await fetchHijriDate();
        await fetchPrayerTimes();
        updatePrayerTable();
        startCountdown();
      }, 300000);

      setInterval(() => {
        updateDateTime();
        handleJamatBlinking();
      }, 1000);
    }

    window.onload = initialize;
  </script>

</body>
</html>
